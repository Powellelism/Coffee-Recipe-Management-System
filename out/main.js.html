<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Script.js

// Import the storage controller object from storage.js
// Separating this isn't super necessary for this lab but keeping
// implementation details separate and silo'd is a nice pattern
import { storage } from './storage.js';

let items; // The variable we'll use to add our array of obejcts we fetch
let itemsURL = 'assets/json/products.json'; // the URL to fetch from

// Bind the init() function to run once the page loads
window.addEventListener('DOMContentLoaded', init);

/** Initializes every function, they all stem from here */
async function init() {
  // Attempt to fetch the product items
  try {
    await fetchItems();
  } catch (err) {
    console.log(`Error fetch items: ${err}`);
    return; // Return if fetch fails
  }
  populatePage(); // Add &lt;product-item> elements to page with fetched data
  bindCartUpdates(); // Add the event listeners to those &lt;product-item> elems
}

/**
 * Fetches all of the products from itemsURL top and stores them
 * inside the global items variable. 
 * @returns {Promise} Resolves if the items are found it localStorage or if they
 *                    are fetched correctly
 */
async function fetchItems() {
  return new Promise((resolve, reject) => {
    const products = localStorage.getItem('products')
    if (products) {
      items = JSON.parse(products);
      resolve();
    } else {
      fetch(itemsURL)
        // Grab the response first, catch any errors here
        .then(response => response.json())
        .catch(err => reject(err))
        // Grab the data next, cach errors here as well
        .then(data => {
          if (data) {
            localStorage.setItem('products', JSON.stringify(data));
            items = data;
            resolve();
          }
        })
        .catch(err => reject(err));
    }
  });
}

/**
 * Adds the Fetched procut items to the webpage
 */
function populatePage() {
  if (!items) return;
  // Get all of the items currently in the cart from storage
  const inCart = storage.getItems();
  // Iterate over each of the items in the array
  items.forEach(item => {
    // Create &lt;product-item> element and populate it with item data
    let productItem = document.createElement('product-item');
    productItem.data = item;
    // If the item was in the cart already, set it to be that way
    if (inCart.indexOf(item.id) > -1) {
      productItem.alreadyInCart();
    }
    // Add the item to the webpage
    document.querySelector('#product-list').appendChild(productItem);
  });
  // Update the cart count in the webpage
  document.querySelector('#cart-count').innerHTML = inCart.length;
}

/**
 * Binds the event listeners to each item for when the add to cart &amp; remove
 * from cart buttons get pressed
 */
function bindCartUpdates() {
  const items = Array.from(document.querySelectorAll('product-item'));
  items.forEach(item => {
    item.addEventListener('addedToCart', () => { addToCart(item.json.id) });
    item.addEventListener('removedFromCart', () => { removeFromCart(item.json.id) });
  });
}

/**
 * Add 1 to the current cart count, update storage accordingly
 */
function addToCart(id) {
  const cartCount = document.querySelector('#cart-count');
  cartCount.innerHTML = Number(cartCount.innerHTML) + 1;
  storage.addItem(id);
}

/**
 * Remove 1 to the current cart count, update storage accordingly
 */
function removeFromCart(id) {
  const cartCount = document.querySelector('#cart-count');
  cartCount.innerHTML = Number(cartCount.innerHTML) - 1;
  storage.removeItem(id);
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addToCart">addToCart</a></li><li><a href="global.html#bindCartUpdates">bindCartUpdates</a></li><li><a href="global.html#fetchItems">fetchItems</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#populatePage">populatePage</a></li><li><a href="global.html#removeFromCart">removeFromCart</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Mon Nov 21 2022 15:57:50 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
